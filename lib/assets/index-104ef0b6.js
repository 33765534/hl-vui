import{r as u,g as N,o as j,k as A,l as C,c as d,L as P,M as W,y as w,a as h,i as F,z as O}from"./index-b4d9421d.js";const R=n=>{const e=[];return n.forEach(o=>{e.push(...o.getElementsByTagName("img"))}),e},K=n=>n.map(e=>e.src),z=n=>{const e=[];return n.forEach((o,l)=>{e[l]=new Promise((f,m)=>{const c=new Image;c.src=o,c.onload=()=>{f({img:o,index:l})}})}),Promise.all(e)},S=n=>{const e=Object.values(n);return Math.min(...e)},q=n=>{const e=Object.values(n);return Math.max(...e)},I=n=>{const e=S(n);return Object.keys(n).find(o=>n[o]===e)},U={key:1},D={__name:"index",props:{data:{type:Array,required:!0},nodeKey:{type:String},column:{default:2,type:Number},columnSpacing:{default:20,type:Number},rowSpacing:{default:20,type:Number},picturePreReading:{type:Boolean,default:!0}},setup(n){const e=n,o=u(0),l=u({}),f=()=>{l.value={};for(let t=0;t<e.column;t++)l.value[t]=0},m=u(null),c=u(0),p=u(0),k=()=>{const{paddingLeft:t,paddingRight:a}=getComputedStyle(m.value,null);p.value=parseFloat(t),c.value=m.value.offsetWidth-parseFloat(t)-parseFloat(a)},r=u(0),_=N(()=>(e.column-1)*e.columnSpacing),y=()=>{k(),r.value=(c.value-_.value)/e.column};j(()=>{y()});let i=[];const b=()=>{i=[];let t=[...document.getElementsByClassName("m-waterfall-item")];const a=R(t),s=K(a);z(s).then(()=>{t.forEach(g=>{i.push(g.offsetHeight)}),v()})},x=()=>{i=[],[...document.getElementsByClassName("m-waterfall-item")].forEach(a=>{i.push(a.offsetHeight)}),v()},v=()=>{e.data.forEach((t,a)=>{t._style||(t._style={},t._style.left=M(),t._style.top=T(),B(a))}),o.value=q(l.value)};A(()=>{e.data.forEach(t=>{delete t._style})});const M=()=>I(l.value)*(r.value+e.columnSpacing)+p.value,T=()=>S(l.value),B=t=>{const a=I(l.value)||0;l.value[a]+=i[t]+e.rowSpacing};C(()=>e.data,t=>{O(()=>{t.every(s=>s._style)||f(),e.picturePreReading?b():x()})},{deep:!0,immediate:!0});const L=()=>{setTimeout(()=>{y(),e.data.forEach(t=>{t._style=null})},200)};return C(()=>e.column,()=>{e.picturePreReading&&(r.value=0),L()}),(t,a)=>(h(),d("div",{class:"relative",ref_key:"containerTarget",ref:m,style:w({height:o.value+"px"})},[r.value&&n.data.length?(h(!0),d(P,{key:0},W(n.data,(s,g)=>{var E,H;return h(),d("div",{key:n.nodeKey?s[n.nodeKey]:g,class:"m-waterfall-item absolute duration-300",style:w({width:r.value+"px",left:((E=s._style)==null?void 0:E.left)+"px",top:((H=s._style)==null?void 0:H.top)+"px"})},[F(t.$slots,"default",{item:s,width:r.value,index:g})],4)}),128)):(h(),d("div",U,"加载中。。。"))],4))}};export{D as default};
